{
  "name": "Flow 3 - User Registration Automation",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "n8n/new-user",
        "responseMode": "responseNode",
        "options": {}
      },
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "new-user-webhook"
    },
    {
      "parameters": {
        "functionCode": "// Extract user data from webhook body\nconst webhookData = items[0].json;\n\n// Debug: log what we received\nconsole.log('Received webhookData:', JSON.stringify(webhookData));\nconsole.log('Keys:', Object.keys(webhookData));\n\n// n8n webhook wraps POST data in 'body' key\n// Check if data is in body (from webhook) or at root level (from test)\nconst userData = webhookData.body || webhookData;\n\nconsole.log('Extracted userData:', JSON.stringify(userData));\n\n// Return array format for Function node v1\nreturn [{\n  json: {\n    user_id: userData.user_id || 0,\n    email: userData.email || '',\n    username: userData.username || '',\n    full_name: userData.full_name || userData.username || 'User',\n    token: userData.token || ''\n  }\n}];"
      },
      "name": "Function: Extract User Data",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.email}}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "name": "IF: Has Valid Email",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "fromEmail": "={{$env.EMAIL_FROM}}",
        "toEmail": "={{$json.email}}",
        "subject": "ChÃ o má»«ng Ä‘áº¿n vá»›i AI Deadline! ğŸ‰",
        "emailType": "html",
        "text": "=Xin chÃ o {{$json.full_name}}!\n\nChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ thÃ nh cÃ´ng tÃ i khoáº£n trÃªn há»‡ thá»‘ng AI Deadline Forecasting Agent.\n\nChÃºng tÃ´i Ä‘Ã£ tá»± Ä‘á»™ng táº¡o sáºµn 1 dá»± Ã¡n máº«u Ä‘á»ƒ báº¡n khÃ¡m phÃ¡ cÃ¡c tÃ­nh nÄƒng cá»§a há»‡ thá»‘ng:\nâœ… Dashboard trá»±c quan vá»›i biá»ƒu Ä‘á»“ thá»‘ng kÃª\nğŸ¤– Dá»± Ä‘oÃ¡n nguy cÆ¡ trá»… deadline báº±ng AI\nğŸ“Š Quáº£n lÃ½ dá»± Ã¡n vÃ  tasks hiá»‡u quáº£\nğŸ”® MÃ´ phá»ng ká»‹ch báº£n What-if\nâš™ï¸ Tá»± Ä‘á»™ng hÃ³a vá»›i n8n workflows\n\nHÃ£y báº¯t Ä‘áº§u tráº£i nghiá»‡m ngay: http://localhost:5173/dashboard\n\nThÃ´ng tin Ä‘Äƒng nháº­p:\n- TÃªn Ä‘Äƒng nháº­p: {{$json.username}}\n- Email: {{$json.email}}\n\n---\nÂ© 2024 AI Deadline Forecasting Agent. All rights reserved.",
        "html": "=<html><head><style>body{font-family:Arial,sans-serif;line-height:1.6;color:#333}.container{max-width:600px;margin:0 auto;padding:20px}.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;text-align:center;border-radius:10px 10px 0 0}.content{background:#f9f9f9;padding:30px;border-radius:0 0 10px 10px}.button{display:inline-block;background:#667eea;color:white;padding:12px 30px;text-decoration:none;border-radius:5px;margin-top:20px}.footer{text-align:center;margin-top:20px;color:#666;font-size:12px}</style></head><body><div class='container'><div class='header'><h1>ğŸ‰ ChÃ o má»«ng Ä‘áº¿n vá»›i AI Deadline!</h1></div><div class='content'><h2>Xin chÃ o {{$json.full_name}}!</h2><p>ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘Äƒng kÃ½ thÃ nh cÃ´ng tÃ i khoáº£n trÃªn há»‡ thá»‘ng <strong>AI Deadline Forecasting Agent</strong>.</p><p>ChÃºng tÃ´i Ä‘Ã£ tá»± Ä‘á»™ng táº¡o sáºµn <strong>1 dá»± Ã¡n máº«u</strong> Ä‘á»ƒ báº¡n khÃ¡m phÃ¡ cÃ¡c tÃ­nh nÄƒng cá»§a há»‡ thá»‘ng:</p><ul><li>âœ… Dashboard trá»±c quan vá»›i biá»ƒu Ä‘á»“ thá»‘ng kÃª</li><li>ğŸ¤– Dá»± Ä‘oÃ¡n nguy cÆ¡ trá»… deadline báº±ng AI</li><li>ğŸ“Š Quáº£n lÃ½ dá»± Ã¡n vÃ  tasks hiá»‡u quáº£</li><li>ğŸ”® MÃ´ phá»ng ká»‹ch báº£n What-if</li><li>âš™ï¸ Tá»± Ä‘á»™ng hÃ³a vá»›i n8n workflows</li></ul><p>HÃ£y báº¯t Ä‘áº§u tráº£i nghiá»‡m ngay:</p><a href='http://localhost:5173/dashboard' class='button'>Truy cáº­p Dashboard</a><p style='margin-top:20px'><strong>ThÃ´ng tin Ä‘Äƒng nháº­p:</strong></p><ul><li>TÃªn Ä‘Äƒng nháº­p: <strong>{{$json.username}}</strong></li><li>Email: <strong>{{$json.email}}</strong></li></ul></div><div class='footer'><p>Â© 2024 AI Deadline Forecasting Agent. All rights reserved.</p><p>Náº¿u báº¡n cáº§n há»— trá»£, vui lÃ²ng liÃªn há»‡: admin@ai-deadline.io.vn</p></div></div></body></html>",
        "options": {}
      },
      "name": "Send Welcome Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [900, 200],
      "credentials": {
        "smtp": {
          "id": "1",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{$env.BACKEND_API_URL}}/api/projects/demo/internal?user_id={{$node['Function: Extract User Data'].json.user_id}}",
        "authentication": "none",
        "method": "POST",
        "sendHeaders": false,
        "options": {}
      },
      "name": "HTTP: Create Demo Project",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "url": "={{$env.BACKEND_API_URL}}/api/webhooks/n8n/automation-log",
        "authentication": "none",
        "method": "POST",
        "sendBody": true,
        "contentType": "json",
        "specifyBody": "json",
        "jsonBody": "={\n  \"workflow_name\": \"User Registration Automation\",\n  \"status\": \"success\",\n  \"input_data\": {{JSON.stringify({user_id: $node['Function: Extract User Data'].json.user_id, email: $node['Function: Extract User Data'].json.email})}},\n  \"output_data\": {{JSON.stringify({email_sent: true, demo_project_created: true, project_id: $json.id || 0})}}\n}",
        "options": {}
      },
      "name": "HTTP: Log Automation",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1340, 200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{JSON.stringify({success: true, message: 'User setup completed', demo_project_id: $json.id || 0})}}",
        "options": {}
      },
      "name": "Webhook Response Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1560, 200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{JSON.stringify({success: false, message: 'Invalid email address'})}}",
        "options": {
          "responseCode": 400
        }
      },
      "name": "Webhook Response Error",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [900, 400]
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Function: Extract User Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function: Extract User Data": {
      "main": [
        [
          {
            "node": "IF: Has Valid Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: Has Valid Email": {
      "main": [
        [
          {
            "node": "Send Welcome Email",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Webhook Response Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Welcome Email": {
      "main": [
        [
          {
            "node": "HTTP: Create Demo Project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP: Create Demo Project": {
      "main": [
        [
          {
            "node": "HTTP: Log Automation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP: Log Automation": {
      "main": [
        [
          {
            "node": "Webhook Response Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "3",
  "id": "3",
  "meta": {
    "instanceId": "ai_deadline_n8n"
  },
  "tags": []
}
